# SegFormer B0 / B2 성능 비교 요약 (CamVid 11 Classes)

### 클래스별 평균 IoU 

| Class      | Sky       | Building  | Pole      | Road      | Pavement  | Tree      | SignSymbol | Fence     | Car       | Pedestrian | Bicyclist |
| ---------- | --------- | --------- | --------- | --------- | --------- | --------- | ---------- | --------- | --------- | ---------- | --------- |
| **B0 Avg** | 87.40     | **72.13** | 66.52     | 21.43     | 45.71     | 96.04     | 87.02      | 42.96     | 76.27     | 82.93      | 84.76     |
| **B2 Avg** | **89.60** | 67.18     | **73.08** | **29.77** | **51.29** | **96.80** | **88.96**  | **49.07** | **79.94** | **86.49**  | **85.12** |

### Fold 평균 성능 요약 (Best 기준)

| 모델               | 평균 mIoU    | 평균 mAcc    | 평균 aAcc    |
| ---------------- | ---------- | ---------- | ---------- |
| **SegFormer B0** | 69.38%     | 76.18%     | 92.95%     |
| **SegFormer B2** | **72.05%** | **78.59%** | **93.59%** |

* B2는 B0 대비 **+2.67% mIoU 향상**.
* Teacher 모델로 B2 적합.

# Knowledge Distillation

## 1. 실험 설정

### 기본 설정
- **해상도**: 288x288 (img_scale: 384x288)
- **Iterations**: 40,000
- **Cross-validation**: 2-fold
- **Batch Size**: 4

### Knowledge Distillation 설정
- **KD Methods**: KL Divergence, Attention Transfer (AT), Similarity Preserving (SP)
- **Teacher Model**: SegFormer B2 (iter_40000.pth)
- **Student Model**: SegFormer B0 (pretrained weights 사용)
- **KL 설정**: Temperature=4.0, Loss Weight=1.0 및 0.5
- **AT/SP 설정**: Loss Weight=1.0
- **Total Loss**: `L_total = L_seg + w × L_KD`
  - `L_seg = CrossEntropyLoss(student_logits, gt_labels)` (weight=1.0)
  - `L_KD`: KL/AT/SP Loss (weight=1.0 또는 0.5)

## 2. 최종 비교 표 (Best mIoU 기준)

| Class      | Sky       | Building  | Pole      | Road      | Pavement  | Tree      | SignSymbol | Fence     | Car       | Pedestrian | Bicyclist | mIoU | mAcc | aAcc |
|---------|---------|---------|---------|---------|---------|---------|---------|---------|---------|---------|----------|------|------|------|
| **B0** | 87.40 | **72.13** | 66.52 | 21.43 | 45.71 | 96.04 | 87.02 | 42.96 | 76.27 | 82.93 | 84.76 | **69.38** | 76.18 | 92.95 |
| **KD(KL) w=1.0** | 88.57 | 63.30 | 69.40 | 22.26 | 46.33 | 96.14 | 88.25 | **43.45** | 78.94 | 83.79 | 83.14 | 69.22 | 76.18 | 92.93 |
| **KD(KL) w=0.5** | 87.38 | 68.61 | 64.55 | 21.01 | **49.15** | **96.38** | 87.40 | 41.29 | 77.14 | **84.30** | **84.77** | 69.34 | 76.13 | 92.91 |
| **KD(AT)** | **88.63** | 62.69 | **69.79** | **22.67** | 46.58 | 96.05 | **88.33** | 43.01 | **78.99** | 83.56 | 83.21 | 69.18 | **76.25** | 92.95 |
| **KD(SP)** | 88.26 | 67.67 | 69.46 | 21.99 | 43.39 | 95.76 | 87.58 | 42.02 | 78.06 | 82.24 | 83.15 | 69.33 | 76.20 | **92.96** |

## 상세 결과

### B0 (Baseline)
- **Fold 1**: mIoU 69.39% (iter 39000), mAcc 76.37%, aAcc 93.06%
- **Fold 2**: mIoU 69.37% (iter 34000), mAcc 75.98%, aAcc 92.83%
- **평균**: mIoU 69.38%, mAcc 76.18%, aAcc 92.95%

### KD(KL) w=1.0
- **Fold 1**: mIoU 69.41% (iter 36000), mAcc 76.55%, aAcc 93.10%
- **Fold 2**: mIoU 69.02% (iter 36000), mAcc 75.81%, aAcc 92.76%
- **평균**: mIoU 69.22%, mAcc 76.18%, aAcc 92.93%

### KD(KL) w=0.5
- **Fold 1**: mIoU 69.32% (iter 38000), mAcc 76.49%, aAcc 93.04%
- **Fold 2**: mIoU 69.35% (iter 40000), mAcc 76.05%, aAcc 92.85%
- **평균**: mIoU 69.34%, mAcc 76.13%, aAcc 92.91%

### KD(AT)
- **Fold 1**: mIoU 69.16% (iter 34000), mAcc 76.69%, aAcc 92.98%
- **Fold 2**: mIoU 69.20% (iter 39000), mAcc 75.81%, aAcc 92.92%
- **평균**: mIoU 69.18%, mAcc 76.25%, aAcc 92.95%

### KD(SP)
- **Fold 1**: mIoU 69.46% (iter 40000), mAcc 76.56%, aAcc 93.18%
- **Fold 2**: mIoU 69.21% (iter 36000), mAcc 75.83%, aAcc 92.73%
- **평균**: mIoU 69.33%, mAcc 76.20%, aAcc 92.96%

## 요약
- **B0 Baseline**: mIoU 69.38% (기준선)
- **KD(SP)**: mIoU 69.33% (B0 대비 -0.05%p, 거의 동일) ⭐ 최고 성능
- **KD(KL) w=0.5**: mIoU 69.34% (B0 대비 -0.04%p, 거의 동일)
- **KD(AT)**: mIoU 69.18% (B0 대비 -0.20%p)
- **KD(KL) w=1.0**: mIoU 69.22% (B0 대비 -0.16%p)
- **결론**: 모든 KD 방법이 B0와 유사한 성능을 보이며, SP와 KL w=0.5가 가장 좋은 성능을 보입니다.
- **클래스별**: 일부 클래스에서는 KD가 B0보다 우수한 성능을 보이지만, 전체적으로는 큰 차이가 없습니다.

# Comment

* Teacher(B2)의 Building 성능이 B0보다 낮다 보니 KD 과정에서 Student(B0)가 오히려 Teacher의 Building 성능을 따라가며 약간 떨어지는 현상이 발생.
* Road·Pole·Fence 등 Teacher가 확실히 강점인 클래스에서는 KD가 도움이 되었지만 Building 같은 Teacher의 약한 클래스가 전체 평균을 끌어내리는 균형 효과가 발생.

문제가 되는 Building만 개선해도 모든 KD 방법론에서 높은 mIoU를 얻을 수 있을 거 같습니다.
코드를 개선하거나 다른 조합의 하이퍼파라미터를 바탕으로 개선이 가능하다고 생각합니다.
